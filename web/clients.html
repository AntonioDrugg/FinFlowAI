<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>FinFlow AI â€” Clients</title>
    <meta name="description" content="Manage your clients in FinFlow AI" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
        rel="stylesheet" />
    <style>
        *,
        *::before,
        *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html,
        body {
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
            background: #f5f7fa;
            color: #1e3a4f;
        }

        /* â•â• NAVBAR â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 68px;
            background: #fff;
            border-bottom: 1px solid #eaecf0;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 36px;
            z-index: 200;
            box-shadow: 0 1px 8px rgba(30, 58, 79, 0.06);
        }

        .nav-links {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 9px 18px;
            border-radius: 8px;
            font-size: 14.5px;
            font-weight: 500;
            color: #5a7080;
            text-decoration: none;
            cursor: pointer;
            transition: background 0.18s, color 0.18s;
            border: none;
            background: none;
            letter-spacing: 0.01em;
        }

        .nav-link:hover,
        .nav-link.active {
            background: #f2f4f6;
            color: #1e3a4f;
            font-weight: 600;
        }

        .nav-icon {
            font-size: 16px;
        }

        .nav-divider {
            width: 1px;
            height: 22px;
            background: #eaecf0;
            margin: 0 8px;
        }

        .nav-right {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .btn-logoff {
            font-family: 'Inter', sans-serif;
            font-size: 13.5px;
            font-weight: 500;
            color: #7a95a8;
            background: none;
            border: 1.5px solid #e2e6ea;
            border-radius: 8px;
            padding: 7px 16px;
            cursor: pointer;
            transition: color 0.18s, border-color 0.18s, background 0.18s;
        }

        .btn-logoff:hover {
            color: #c0392b;
            border-color: #f5c6c2;
            background: #fff5f5;
        }

        .nav-logo img {
            height: 54px;
            width: auto;
            display: block;
        }

        /* â•â• ACCENT BAR â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .accent-bar {
            height: 8px;
            margin-top: 68px;
            background: linear-gradient(135deg, #1e3a4f 0%, #2a5270 60%, #1e3a4f 100%);
        }

        /* â•â• PAGE WRAPPER â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .page {
            padding: 16px 48px;
        }

        /* â•â• SECTION CARD â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .card {
            background: #fff;
            border: 1px solid #eaecf0;
            border-radius: 14px;
            padding: 14px 20px;
            margin-bottom: 12px;
        }

        .card-title {
            font-size: 10px;
            font-weight: 700;
            letter-spacing: 0.10em;
            text-transform: uppercase;
            color: #9ab0bf;
            margin-bottom: 10px;
            padding-bottom: 7px;
            border-bottom: 1px solid #f0f3f5;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .card-title-icon {
            font-size: 12px;
        }

        /* â•â• FORM GRID â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px 14px;
        }

        .col-2 {
            grid-column: span 2;
        }

        .col-3 {
            grid-column: span 3;
        }

        .col-4 {
            grid-column: span 4;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .form-group label {
            font-size: 11px;
            font-weight: 600;
            color: #7a95a8;
            letter-spacing: 0.05em;
            text-transform: uppercase;
        }

        .form-group input,
        .form-group select {
            font-family: 'Inter', sans-serif;
            font-size: 13.5px;
            color: #1e3a4f;
            background: #f7f9fb;
            border: 1.5px solid #dce3ea;
            border-radius: 8px;
            padding: 9px 13px;
            outline: none;
            transition: border-color 0.18s, box-shadow 0.18s;
            width: 100%;
        }

        .form-group input::placeholder {
            color: #b0bec8;
        }

        .form-group input:focus,
        .form-group select:focus {
            border-color: #3ecf8e;
            box-shadow: 0 0 0 3px rgba(62, 207, 142, 0.12);
            background: #fff;
        }

        /* FinFlow # badge */
        .finflow-badge {
            display: inline-flex;
            align-items: center;
            background: #e8f7f1;
            border: 1px solid #b8ead1;
            border-radius: 8px;
            padding: 9px 13px;
            font-size: 14px;
            font-weight: 700;
            color: #2db87a;
            letter-spacing: 0.06em;
            min-height: 42px;
        }

        /* â•â• FORM ACTION ROW â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .form-actions {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-top: 4px;
        }

        .btn-register {
            font-family: 'Inter', sans-serif;
            font-size: 14px;
            font-weight: 600;
            color: #fff;
            background: linear-gradient(135deg, #3ecf8e, #2db87a);
            border: none;
            border-radius: 8px;
            padding: 11px 32px;
            cursor: pointer;
            transition: opacity 0.18s, transform 0.15s;
        }

        .btn-register:hover {
            opacity: 0.88;
            transform: translateY(-1px);
        }

        .btn-register:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        #form-msg {
            font-size: 13px;
            font-weight: 500;
            min-height: 18px;
        }

        #form-msg.ok {
            color: #2db87a;
        }

        #form-msg.err {
            color: #c0392b;
        }

        /* â•â• CLIENT LIST â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .list-card {
            background: #fff;
            border: 1px solid #eaecf0;
            border-radius: 14px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .list-header {
            padding: 16px 24px 12px;
            border-bottom: 1px solid #eaecf0;
            display: flex;
            align-items: baseline;
            gap: 8px;
        }

        .list-header .card-title {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }

        #client-count {
            font-size: 11px;
            color: #b0bec8;
            font-weight: 400;
        }

        .table-wrap {
            max-height: 380px;
            overflow-y: auto;
            overflow-x: auto;
        }

        .table-wrap::-webkit-scrollbar {
            width: 6px;
        }

        .table-wrap::-webkit-scrollbar-track {
            background: #f5f7fa;
        }

        .table-wrap::-webkit-scrollbar-thumb {
            background: #d0dbe3;
            border-radius: 3px;
        }

        .table-wrap::-webkit-scrollbar-thumb:hover {
            background: #b0c4ce;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead th {
            position: sticky;
            top: 0;
            background: #f7f9fb;
            font-size: 10.5px;
            font-weight: 700;
            letter-spacing: 0.08em;
            text-transform: uppercase;
            color: #9ab0bf;
            padding: 10px 14px;
            text-align: left;
            border-bottom: 1px solid #eaecf0;
            white-space: nowrap;
            z-index: 1;
        }

        tbody tr {
            border-bottom: 1px solid #f0f3f5;
            transition: background 0.14s;
        }

        tbody tr:last-child {
            border-bottom: none;
        }

        tbody tr:hover {
            background: #f7fbf9;
        }

        tbody td {
            padding: 11px 14px;
            font-size: 13px;
            vertical-align: middle;
            white-space: nowrap;
        }

        .td-ff {
            color: #2db87a;
            font-weight: 700;
            font-size: 12.5px;
            white-space: nowrap;
        }

        .td-name {
            font-weight: 600;
            color: #1e3a4f;
        }

        .td-grey {
            color: #7a95a8;
        }

        .td-faint {
            color: #b0bec8;
            font-size: 12px;
            white-space: nowrap;
        }

        .btn-del {
            background: none;
            border: none;
            cursor: pointer;
            color: #c8d5de;
            font-size: 14px;
            padding: 4px 6px;
            border-radius: 6px;
            transition: color 0.15s, background 0.15s;
        }

        .btn-del:hover {
            color: #c0392b;
            background: #fff0ee;
        }

        .empty-state {
            text-align: center;
            padding: 48px 24px;
            color: #b0bec8;
        }

        .empty-state .icon {
            font-size: 36px;
            margin-bottom: 10px;
        }

        .empty-state p {
            font-size: 13.5px;
        }

        /* â•â• BOTTOM BAR â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .bottom-bar {
            display: flex;
            justify-content: flex-end;
            padding-bottom: 40px;
        }

        .btn-back {
            font-family: 'Inter', sans-serif;
            font-size: 13.5px;
            font-weight: 500;
            color: #5a7080;
            background: #fff;
            border: 1.5px solid #dce3ea;
            border-radius: 8px;
            padding: 9px 22px;
            cursor: pointer;
            transition: color 0.18s, border-color 0.18s, background 0.18s;
            display: flex;
            align-items: center;
            gap: 7px;
        }

        .btn-back:hover {
            color: #1e3a4f;
            border-color: #b0bec8;
            background: #f7f9fb;
        }

        /* â•â• RESPONSIVE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        @media (max-width: 900px) {
            .form-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .col-2,
            .col-3,
            .col-4 {
                grid-column: span 2;
            }

            .page {
                padding: 20px 20px;
            }

            .navbar {
                padding: 0 20px;
            }
        }

        @media (max-width: 540px) {
            .form-grid {
                grid-template-columns: 1fr;
            }

            .col-2,
            .col-3,
            .col-4 {
                grid-column: span 1;
            }
        }
    </style>
</head>

<body>

    <!-- â•â• NAVBAR â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <nav class="navbar" role="navigation" aria-label="Main navigation">
        <div class="nav-links">
            <a href="/home.html" class="nav-link" id="nav-home">
                <span class="nav-icon">ğŸ </span><span>Home</span>
            </a>
            <div class="nav-divider"></div>
            <a href="/clients.html" class="nav-link active" id="nav-clients">
                <span class="nav-icon">ğŸ‘¥</span><span>Clients</span>
            </a>
            <a href="/processes.html" class="nav-link" id="nav-processes">
                <span class="nav-icon">âš™ï¸</span><span>Processes</span>
            </a>
            <div class="nav-divider"></div>
            <a href="/home.html" class="nav-link" id="nav-reports">
                <span class="nav-icon">ğŸ“Š</span><span>Reports</span>
            </a>
            <div class="nav-divider"></div>
            <a href="/space-setup.html" class="nav-link" id="nav-space-setup">
                <span class="nav-icon">ğŸ”§</span><span>Space Setup</span>
            </a>
        </div>
        <div class="nav-right">
            <button class="btn-logoff" onclick="logOff()">Log Off</button>
            <div class="nav-logo">
                <img src="assets/logo-inline-2.png" alt="FinFlow AI" draggable="false" />
            </div>
        </div>
    </nav>

    <!-- â•â• ACCENT BAR â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="accent-bar"></div>

    <!-- â•â• PAGE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="page">

        <!-- â”€â”€â”€ SECTION 1: Personal Information â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
        <div class="card">
            <div class="card-title">
                <span class="card-title-icon">ğŸªª</span> Personal Information
            </div>
            <div class="form-grid">

                <div class="form-group">
                    <label>FinFlow Number</label>
                    <div class="finflow-badge" id="ff-number-display">Auto-assigned</div>
                </div>

                <div class="form-group col-2">
                    <label for="f-name">Name *</label>
                    <input id="f-name" type="text" placeholder="Full legal name" />
                </div>

                <div class="form-group">
                    <label for="f-civil">Civil Status</label>
                    <select id="f-civil">
                        <option value="">â€” Select â€”</option>
                        <option>Single</option>
                        <option>Married</option>
                        <option>Divorced</option>
                        <option>Widowed</option>
                        <option>Separated</option>
                        <option>Civil Partnership</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="f-crn">Client Registration Number</label>
                    <input id="f-crn" type="text" placeholder="e.g. CRN-12345" autocomplete="off" />
                </div>

                <div class="form-group">
                    <label for="f-pps">PPS Number</label>
                    <input id="f-pps" type="text" placeholder="1234567T" autocomplete="off" />
                </div>

                <div class="form-group">
                    <label for="f-dob">Date of Birth</label>
                    <input id="f-dob" type="date" />
                </div>

                <div class="form-group">
                    <label for="f-revpwd">Revenue Password</label>
                    <input id="f-revpwd" type="text" placeholder="Revenue online password" autocomplete="off" />
                </div>

            </div>
        </div>

        <!-- â”€â”€â”€ SECTION 2: Contact Details â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
        <div class="card">
            <div class="card-title">
                <span class="card-title-icon">ğŸ“</span> Contact Details
            </div>
            <div class="form-grid">

                <div class="form-group col-2">
                    <label for="f-email">Email</label>
                    <input id="f-email" type="email" placeholder="name@example.com" />
                </div>

                <div class="form-group">
                    <label for="f-mobile">Mobile</label>
                    <input id="f-mobile" type="tel" placeholder="+353 8X XXX XXXX" />
                </div>

                <div class="form-group">
                    <label for="f-othphone">Other Phone Number</label>
                    <input id="f-othphone" type="tel" placeholder="+353 1 XXX XXXX" />
                </div>

            </div>
        </div>

        <!-- â”€â”€â”€ SECTION 3: Address â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
        <div class="card">
            <div class="card-title">
                <span class="card-title-icon">ğŸ </span> Address
            </div>
            <!-- All 5 address fields on a single row -->
            <div class="form-grid" style="grid-template-columns: 2fr 1fr 1fr 2fr 1fr;">

                <div class="form-group">
                    <label for="f-addr1">Address Line 1</label>
                    <input id="f-addr1" type="text" placeholder="Street address" />
                </div>

                <div class="form-group">
                    <label for="f-addr2">Address Line 2</label>
                    <input id="f-addr2" type="text" placeholder="Apartment" />
                </div>

                <div class="form-group">
                    <label for="f-addr3">Address Line 3</label>
                    <input id="f-addr3" type="text" placeholder="Townland" />
                </div>

                <div class="form-group">
                    <label for="f-city">City / County</label>
                    <input id="f-city" type="text" placeholder="Dublin / Corkâ€¦" />
                </div>

                <div class="form-group">
                    <label for="f-eircode">Eircode</label>
                    <input id="f-eircode" type="text" placeholder="D01 X2Y3" />
                </div>

            </div>
        </div>

        <!-- â”€â”€â”€ SECTION 4: Banking â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
        <div class="card">
            <div class="card-title">
                <span class="card-title-icon">ğŸ¦</span> Banking Details
            </div>
            <!-- 3 equal cols: holder name + IBAN + BIC all on one line -->
            <div class="form-grid" style="grid-template-columns: 2fr 2fr 1fr;">

                <div class="form-group">
                    <label for="f-bankname">Account Holder's Name</label>
                    <input id="f-bankname" type="text" placeholder="Name on bank account" />
                </div>

                <div class="form-group">
                    <label for="f-iban">IBAN</label>
                    <input id="f-iban" type="text" placeholder="IE29 AIBK 9311 5212 3456 78" autocomplete="off" />
                </div>

                <div class="form-group">
                    <label for="f-bic">BIC</label>
                    <input id="f-bic" type="text" placeholder="AIBKIE2D" autocomplete="off" />
                </div>

            </div>
        </div>

        <!-- â”€â”€â”€ REGISTER BUTTON â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
        <div class="form-actions" style="margin-bottom:32px;">
            <button class="btn-register" id="btn-register" onclick="registerClient()">Register Client</button>
            <span id="form-msg"></span>
        </div>

        <!-- â”€â”€â”€ CLIENT LIST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
        <div class="list-card">
            <div class="list-header">
                <div class="card-title">
                    <span class="card-title-icon">ğŸ‘¥</span> Registered Clients
                </div>
                <div style="display:flex; align-items:center; gap:8px; margin-left:auto;">
                    <span id="client-count"></span>

                    <!-- Template download -->
                    <button id="btn-template" onclick="downloadTemplate()" style="font-size:12.5px; font-weight:600; color:#7a6fcf;
                               background:#f3f1fd; border:1.5px solid #c9c3f0; border-radius:7px;
                               padding:5px 12px; cursor:pointer; display:flex; align-items:center; gap:5px;
                               transition:background 0.18s, border-color 0.18s; font-family:inherit;"
                        onmouseover="this.style.background='#e5e0fb'; this.style.borderColor='#9d92e0';"
                        onmouseout="this.style.background='#f3f1fd';  this.style.borderColor='#c9c3f0';">
                        &#128196; Template
                    </button>

                    <!-- CSV import (hidden input) -->
                    <input type="file" id="csv-file-input" accept=".csv" style="display:none;"
                        onchange="importClients(this)" />
                    <button id="btn-import" onclick="document.getElementById('csv-file-input').click()" style="font-size:12.5px; font-weight:600; color:#1a7a4a;
                               background:#f0fbf6; border:1.5px solid #b8ead1; border-radius:7px;
                               padding:5px 12px; cursor:pointer; display:flex; align-items:center; gap:5px;
                               transition:background 0.18s, border-color 0.18s; font-family:inherit;"
                        onmouseover="this.style.background='#d8f5eb'; this.style.borderColor='#3ecf8e';"
                        onmouseout="this.style.background='#f0fbf6';  this.style.borderColor='#b8ead1';">
                        &#8593; Import
                    </button>

                    <!-- Extract all -->
                    <a href="/api/clients/export.csv" id="btn-export" style="font-size:12.5px; font-weight:600; color:#2db87a;
                               text-decoration:none; display:flex; align-items:center; gap:5px;
                               padding:5px 12px; border:1.5px solid #b8ead1; border-radius:7px;
                               background:#f0fbf6; transition:background 0.18s, border-color 0.18s;"
                        onmouseover="this.style.background='#d8f5eb'; this.style.borderColor='#3ecf8e';"
                        onmouseout="this.style.background='#f0fbf6'; this.style.borderColor='#b8ead1';">
                        &#8595; Extract all
                    </a>
                </div>
            </div>
            <div class="table-wrap" style="overflow-x: auto;">
                <table style="white-space:nowrap;">
                    <thead>
                        <tr>
                            <th>FF #</th>
                            <th>Name</th>
                            <th>Civil Status</th>
                            <th>Reg. Number</th>
                            <th>PPS Number</th>
                            <th>Date of Birth</th>
                            <th>Revenue Password</th>
                            <th>Email</th>
                            <th>Mobile</th>
                            <th>Other Phone</th>
                            <th>Address Line 1</th>
                            <th>Address Line 2</th>
                            <th>Address Line 3</th>
                            <th>City / County</th>
                            <th>Eircode</th>
                            <th>Bank Holder Name</th>
                            <th>IBAN</th>
                            <th>BIC</th>
                            <th>Registered</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody id="clients-body"></tbody>
                </table>
                <div id="empty-state" class="empty-state" style="display:none;">
                    <div class="icon">ğŸ‘¤</div>
                    <p>No clients registered yet.<br />Use the form above to add the first one.</p>
                </div>
            </div>
        </div>

        <!-- â”€â”€â”€ BOTTOM BAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
        <div class="bottom-bar">
            <button class="btn-back" onclick="window.location.href='/home.html'">&#8592; Back</button>
        </div>

    </div><!-- /page -->

    <script>
        // â”€â”€ Session â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        function logOff() {
            ['finflow_name', 'finflow_space', 'finflow_login'].forEach(k => sessionStorage.removeItem(k));
            window.location.href = '/';
        }

        // â”€â”€ Helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        function escHtml(s) {
            return String(s ?? '').replace(/&/g, '&amp;').replace(/</g, '&lt;')
                .replace(/>/g, '&gt;').replace(/"/g, '&quot;');
        }
        function fmtDate(iso) {
            if (!iso) return 'â€”';
            return new Date(iso).toLocaleDateString('en-GB', { day: '2-digit', month: 'short', year: 'numeric' });
        }
        function showMsg(text, type) {
            const el = document.getElementById('form-msg');
            el.textContent = text;
            el.className = type;
            if (type === 'ok') setTimeout(() => { el.textContent = ''; el.className = ''; }, 3500);
        }

        // â”€â”€ Collect form data â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // â”€â”€ Space â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        const SPACE = sessionStorage.getItem('finflow_space') || '';
        function spaceCode(s) {
            s = (s || '').trim();
            return s.length >= 2 ? s.slice(0, 2).toUpperCase() : (s ? s.toUpperCase() : 'FF');
        }
        const PREFIX = spaceCode(SPACE);
        document.getElementById('ff-number-display').textContent = PREFIX + '-Auto';

        // â”€â”€ Collect form data â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        function getFormData() {
            return {
                space: SPACE,
                name: document.getElementById('f-name').value,
                civil_status: document.getElementById('f-civil').value,
                client_reg_number: document.getElementById('f-crn').value,
                pps_number: document.getElementById('f-pps').value,
                date_of_birth: document.getElementById('f-dob').value,
                revenue_password: document.getElementById('f-revpwd').value,
                email: document.getElementById('f-email').value,
                mobile: document.getElementById('f-mobile').value,
                other_phone: document.getElementById('f-othphone').value,
                address_line1: document.getElementById('f-addr1').value,
                address_line2: document.getElementById('f-addr2').value,
                address_line3: document.getElementById('f-addr3').value,
                city_county: document.getElementById('f-city').value,
                eir_code: document.getElementById('f-eircode').value,
                bank_holder_name: document.getElementById('f-bankname').value,
                bank_iban: document.getElementById('f-iban').value,
                bank_bic: document.getElementById('f-bic').value,
            };
        }

        function clearForm() {
            ['f-name', 'f-civil', 'f-crn', 'f-pps', 'f-dob', 'f-revpwd', 'f-email', 'f-mobile',
                'f-othphone', 'f-addr1', 'f-addr2', 'f-addr3', 'f-city', 'f-eircode',
                'f-bankname', 'f-iban', 'f-bic'].forEach(id => {
                    const el = document.getElementById(id);
                    if (el) el.value = '';
                });
            document.getElementById('ff-number-display').textContent = PREFIX + '-Auto';
        }

        // â”€â”€ Render client table (all fields) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        function renderClients(clients) {
            const body = document.getElementById('clients-body');
            const empty = document.getElementById('empty-state');
            const count = document.getElementById('client-count');
            body.innerHTML = '';
            count.textContent = clients.length ? `(${clients.length})` : '';
            if (!clients.length) { empty.style.display = 'block'; return; }
            empty.style.display = 'none';

            const v = (val) => escHtml(val || 'â€”');  // blank â†’ em-dash

            clients.forEach(c => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td class="td-ff">${escHtml(c.finflow_number)}</td>
                    <td class="td-name">${v(c.name)}</td>
                    <td class="td-grey">${v(c.civil_status)}</td>
                    <td class="td-grey">${v(c.client_reg_number)}</td>
                    <td class="td-grey">${v(c.pps_number)}</td>
                    <td class="td-grey">${v(c.date_of_birth)}</td>
                    <td class="td-grey">${v(c.revenue_password)}</td>
                    <td class="td-grey">${v(c.email)}</td>
                    <td class="td-grey">${v(c.mobile)}</td>
                    <td class="td-grey">${v(c.other_phone)}</td>
                    <td class="td-grey">${v(c.address_line1)}</td>
                    <td class="td-grey">${v(c.address_line2)}</td>
                    <td class="td-grey">${v(c.address_line3)}</td>
                    <td class="td-grey">${v(c.city_county)}</td>
                    <td class="td-grey">${v(c.eir_code)}</td>
                    <td class="td-grey">${v(c.bank_holder_name)}</td>
                    <td class="td-grey">${v(c.bank_iban)}</td>
                    <td class="td-grey">${v(c.bank_bic)}</td>
                    <td class="td-faint">${fmtDate(c.created_at)}</td>
                    <td><button class="btn-del" title="Delete" onclick="deleteClient(${c.id})">âœ•</button></td>
                `;
                body.appendChild(tr);
            });
        }

        // â”€â”€ Load clients â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        async function loadClients() {
            try {
                const res = await fetch('/api/clients?space=' + encodeURIComponent(SPACE));
                renderClients(await res.json());
            } catch { showMsg('Could not load clients. Is the server running?', 'err'); }
        }

        // â”€â”€ Register â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        async function registerClient() {
            const data = getFormData();
            if (!data.name.trim()) { showMsg('Name is required.', 'err'); return; }

            const btn = document.getElementById('btn-register');
            btn.disabled = true; btn.textContent = 'Savingâ€¦';

            try {
                const res = await fetch('/api/clients', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data),
                });
                const result = await res.json();
                if (res.ok) {
                    showMsg(`âœ“ ${result.name} registered as ${result.finflow_number}.`, 'ok');
                    clearForm();
                    loadClients();
                } else {
                    showMsg(result.error || 'Registration failed.', 'err');
                }
            } catch { showMsg('Server error. Please try again.', 'err'); }
            finally { btn.disabled = false; btn.textContent = 'Register Client'; }
        }

        // â”€â”€ Delete â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        async function deleteClient(id) {
            if (!confirm('Delete this client? This cannot be undone.')) return;
            try {
                const res = await fetch('/api/clients/' + id + '?space=' + encodeURIComponent(SPACE), { method: 'DELETE' });
                if (res.ok) loadClients();
                else showMsg('Could not delete client.', 'err');
            } catch { showMsg('Server error.', 'err'); }
        }

        // â”€â”€ Import CSV â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        async function importClients(input) {
            const file = input.files[0];
            if (!file) return;
            input.value = '';   // reset so same file can be re-selected

            const btn = document.getElementById('btn-import');
            btn.disabled = true;
            btn.textContent = 'Importing\u2026';

            const form = new FormData();
            form.append('file', file);

            try {
                const res = await fetch(
                    '/api/clients/import.csv?space=' + encodeURIComponent(SPACE),
                    { method: 'POST', body: form }
                );
                const data = await res.json();

                if (!res.ok) {
                    showMsg(data.error || 'Import failed.', 'err');
                    return;
                }

                let msg = data.added + ' client(s) imported';
                if (data.skipped) msg += ', ' + data.skipped + ' skipped (no name)';
                if (data.errors && data.errors.length) {
                    msg += ', ' + data.errors.length + ' error(s): ' +
                        data.errors.map(e => 'row ' + e.row + ' (' + e.error + ')').join('; ');
                }
                showMsg(msg, data.errors && data.errors.length ? 'err' : 'ok');
                loadClients();
            } catch {
                showMsg('Import failed. Check the file and try again.', 'err');
            } finally {
                btn.disabled = false;
                btn.textContent = '\u2191 Import';
            }
        }

        // â”€â”€ Download template CSV â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        function downloadTemplate() {
            const cols = [
                'name', 'civil_status', 'client_reg_number', 'pps_number', 'date_of_birth', 'revenue_password',
                'email', 'mobile', 'other_phone',
                'address_line1', 'address_line2', 'address_line3',
                'city_county', 'eir_code',
                'bank_holder_name', 'bank_iban', 'bank_bic'
            ];
            const csv = cols.join(',') + '\r\n';
            const blob = new Blob(['\uFEFF' + csv], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'finflowai_import_template.csv';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // â”€â”€ Enter key on any input â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        document.querySelectorAll('input').forEach(el => {
            el.addEventListener('keydown', e => { if (e.key === 'Enter') registerClient(); });
        });

        // â”€â”€ Init â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // Point the export link at the space-scoped URL
        const exportLink = document.getElementById('btn-export');
        if (exportLink) exportLink.href = '/api/clients/export.csv?space=' + encodeURIComponent(SPACE);
        loadClients();

    </script>

</body>

</html>